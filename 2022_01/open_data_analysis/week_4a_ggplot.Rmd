---
title: "data_visualization"
author: "junghyun"
date: '2022 3 29 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)

```


###2. 2. Aesthetic mappings
mpg 데이터프레임 안에 class 변수와 같이 x축, y축이 아닌 세 번째 변수를 aesthetic mapping하여 2차원 그래프에 추가할 수 있습니다.
여기서 말하는 aesthetic mapping은 aes() argument에 포함되는 부분으로 크기(size), 모양(shape) 또는 색깔(color, colour) 등 이 포함됩니다.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```
```{r}
#mapping 생략 가능
ggplot(mpg) + 
  geom_point(aes(displ,hwy))
```
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy))+
  geom_point()+
  geom_point(data = mpg %>% filter(displ > 5, hwy > 20),color = "red",size=2.2)
```

### Aesthetic mappings

```{r}
table(mpg$class)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
```
```{r}
# Left
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))
```

```{r}
# Right
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))
```

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), col = "blue")
```

### Common problems

```{r}
# + 위치에 따라 오류가 날 수 있음
# ggplot(data = mpg) + 
#  geom_point(mapping = aes(x = displ, y = hwy))
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

### 2. 3. Facets
aes() argument를 이용하여 2차원 외에 추가 변수를 고려하는 방법도 있지만, 범주형 변수에 유용한 또 다른 방법이 존재합니다.
즉, 범주형 변수의 수준에 따라 그래프를 분할하여 표시하는 방법입니다. 이 때 이용하는 대표적인 함수로는 facet_wrap()과 facet_grid() 가 있습니다.
facet_wrap(~ variable) 함수는 이산형(범주형) 변수일 때 쓰입니다.
facet_grid(variable ~ variable) 함수는 두 변수까지 고려할 수 있습니다.

```{r}

table(mpg$class)
ggplot(data=mpg %>% filter(class=="midsize")) +
  geom_point(mapping = aes(x=displ, y = hwy))  

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```
```{r}
table(mpg$cyl)

ggplot(data = mpg)+
  geom_point(mapping = aes(x = displ, y = hwy))+
  facet_grid(drv~cyl)
```
### 2. 4. Geometric objects

geom_smooth()는 ggplot2 패키지에서 추세선(trend line)을 그려 주는 함수입니다. 특히 산포도(산점도, scatter plot)를 그릴 때 xy평면에 산개한 점들의 추세를 함께 나타낼 경우에 많이 사용됩니다.


```{r}
#geom_point()로 산점도를 먼저 그리고, geom_smooth()를 추가하여 추세선을 함께 그린 것

# left
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))

# right
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy))
```
```{r}
# aes() 내부에 linetype = drv argument를 사용하여 변수 drv 수준에 따라 smooth line을 다르게 하여 출력할 수도 있습니다.

ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))

ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy))


ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))

#또한 show.legend = FALSE argument를 이용하여 범례 없이 출력할 수도 있습니다.

ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE
  )


ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))


# View(mpg)
```

동일한 그림에 여러 개의 geom을 표시하려면 여러 개의 geom 함수를 ggplot()에 추가합니다.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(x = displ, y = hwy)) 
```
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()

ggplot(data = mpg, mapping = aes(x = displ, y = cty)) + 
  geom_point() + 
  geom_smooth()


```

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth()
```
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) + 
  geom_point() + 
  geom_smooth()
```
```{r}
# 여기서 우리의 평활선 은 mpg 데이터셋의 서브셋인 (subcompact)경차만을 표시한다. 
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth(data = mpg %>% filter(class == "subcompact"), se = FALSE) #se = : 표준오차
```

```{r}
mpg %>% View()
```

#Statistical transformations

```{r}
diamonds

table(diamonds$cut)
glimpse(diamonds)
```
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut)) #y축은 입력안해도댐
```
```{r}
# 값을 계산해서 넣어줌
ggplot(data = diamonds) + 
  stat_count(mapping = aes(x = cut))
```
# Position adjustments

```{r}
# 테두리의 컬러
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, colour = cut))
```
```{r}
# 막대 컬러
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = cut))
```
```{r}
# x와 fill 각각의 컬러
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity))
```
```{r}
# position = "identity" 를 하면 각 객체를 그래프 문맥에 해당되는 곳에 정확히 배치한다. 막대와 겹치기 때문에 막대에 대해서는 그다지 유용하지 않다. 
ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) + 
  geom_bar(alpha = 1/5, position = "identity")
```
```{r}
# 겹치는 것을 구별하려면 alpha를 작은 값으로 설정하여 막대들을 약간 투명하게 하거나, fill = NA 로 설정하여 완전히 투명하게 해야 한다.
ggplot(data = diamonds, mapping = aes(x = cut, colour = clarity)) + 
  geom_bar(fill = NA, position = "identity")
```
```{r}
# 비율의 차이가 보고 싶을 때
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "fill")
```
```{r}
# dodge 각각의 비율을 볼 수 있음
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "dodge")
```
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), position = "jitter")
```
```{r}
# 데이터가 더 퍼지게 해줌
ggplot(data = mpg) + 
  geom_jitter(mapping = aes(x = displ, y = hwy))
```
# Coordinate systems
```{r}
ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot()
```
```{r}
ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot() +
  coord_flip()
```
```{r}
library(maps)
nz <- map_data("nz")

ggplot(nz, aes(long, lat, group = group)) +
  geom_polygon(fill = "white", colour = "black")
```
```{r}
ggplot(nz, aes(long, lat, group = group)) +
  geom_polygon(fill = "white", colour = "black") +
  coord_quickmap()
```
```{r}
bar <- ggplot(data = diamonds) + 
  geom_bar(
    mapping = aes(x = cut, fill = cut), 
    show.legend = FALSE,
    width = 1
  ) + 
  theme(aspect.ratio = 1) +
  labs(x = NULL, y = NULL)

bar
```
```{r}
bar + coord_flip()
```
```{r}
bar + coord_polar()
```

